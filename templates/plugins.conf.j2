{{ ansible_managed|comment }}
{% macro display_parameter(parameter_name, parameter_value, space) -%}
{% if parameter_value is equalto True %}
{{ space }}  {{ parameter_name }} = {{ parameter_value|lower }}
{% elif parameter_value is equalto False %}
{{ space }}  {{ parameter_name }} = {{ parameter_value|lower }}
{% elif parameter_value is string %}
{{ space }}  {{ parameter_name }} = "{{ parameter_value }}"
{% elif parameter_value is number %}
{{ space }}  {{ parameter_name }} = {{ parameter_value }}
{% else %}
{{ space }}  {{ parameter_name }} = [
{% for val in parameter_value %}
{{ space }}    {% if val is string %}"{{ val }}"{% else %}{{ val }}{% endif %},
{% endfor %}
{{ space }}  ]
{% endif %}
{%- endmacro %}

{% macro plugins(conf, plugin_name) %}
{% for plugin in conf if plugin.name == plugin_name and plugin.enabled|default(true) recursive %}
{% set space = ""|indent(loop.depth0 * 2, true) %}
{{ space }}[[{{ plugin.type|default('inputs') }}.{{ plugin.name }}]]
{% if plugin.parameters is defined and plugin.parameters is iterable %}
{% for parameter_name, parameter_value in plugin.parameters.iteritems() %}
{{ display_parameter(parameter_name, parameter_value, space) }}
{%- endfor %}
{% endif %}
{% if plugin.sections is defined %}
{{ loop(plugin.sections) }}
{% endif %}
{% for custom_section in ['tagpass', 'tagdrop', 'tags' ] if plugin[custom_section] is defined and plugin[custom_section] is iterable %}
{% set space = ""|indent(loop.depth * 2, true) %}
{{ space }}[{{ plugin.type|default('inputs') }}.{{ plugin.name }}.{{ custom_section }}]
{% for parameter_name, parameter_value in plugin[custom_section].iteritems() -%}
{{ display_parameter(parameter_name, parameter_value, space) }}
{%- endfor %}
{% endfor %}
{% endfor %}
{%- endmacro %}

{% if telegraf__conf__plugins is iterable %}
{{ plugins(telegraf__conf__plugins__extra, item.name) }}
{% endif %}
